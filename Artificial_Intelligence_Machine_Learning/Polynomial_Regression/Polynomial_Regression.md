This is a group assignment. Go into the "People" section and join a group. Groups may have between 1 and 3 people.

This assignment explores under and overfitting in the context of polynomial regression. You will generate synthetic data and fit several polynomials to it.

Generating Data
Complete the following functions:

def generate_coefficients():
    """"
    Returns an array of five numbers, to be used as coefficients of a polynomial. Each number is chosen uniformly from the
    interval [-0.5, 0.5).
    """
    # You have to finish this

def generate_data(m, coefficients):
    """
    Returns two arrays, X and y, each of which is m by 1. The values of X are evenly spaced across the interval
    [-5.0, 5.0]. For each x, the corresponding y value is

    a + b * X + c * X**2 + d * X**3 + e * X**4 + <noise>

    where coefficients is (a, b, c, d, e) and the noise for each point is normally distributed with mean 0 and
    standard deviation 1.
    """
    # You have to finish this
To verify that this is working correctly, you can use this collection of unit tests  download. Either run that file directly in PyCharm or, from the command line (with your virtual environment set up):

python test_polynomial.py
Depending on how your system is set up, you might have to use python3 instead of python.

If you

c = generate_coefficients()
X, y = generate_data(100, c)
plt.scatter(X, y)
plt.show()
you should get a plot that looks something like this (although your random data may be different):

Scatter plot

Fitting Curves
Now it's time to fit some polynomial curves to the data. Complete the following functions:

def fit_curve(X, y, degree):
    """
    Returns a trained model that fits a polynomial of the specified degree to the data.
    """
    # You have to write this


def plot_curve(degree, model):
    """
    Plots a curve for model, which represents a polynomial of the specified degree.
    The x values for the curve are 100 points evenly spaced across the interval [-5.0, 5.0].
    """
    # You have to write this
Now add these (already complete) functions to your file:

def plot_data(X, y):
    """
    Plots X and y (as a scatter plot) and also constrains the y limit so that later, much larger values of y will not
    reset it.
    """
    plt.ylim((y.min() - 0.1 * (y.max() - y.min()),
              y.max() + 0.1 * (y.max() - y.min())))
    plt.scatter(X, y)


def experiment_1(m):
    """
    Generates m training points and fits models of degrees 1, 2, and 20. Plots the data and the curves for the models.
    """
    coeffs = generate_coefficients()
    X, y = generate_data(m, coeffs)
    plot_data(X, y)
    for d in [1, 2, 20]:
        model = fit_curve(X, y, d)
        plot_curve(d, model)
    plt.xlabel('x')
    plt.ylabel('y')
    plt.legend()
    plt.show()
If you now run

experiment_1(20)
you should get a plot something like this:

curves.png

You should also run experiment_1 a few times with different parameters, like 10 or 20. Try to figure out why it behaves differently.

Sensitivity Study
Now it's time to explore which degrees of polynomial models work best in which circumstances. Complete this function:

def mse(X, y, degree, model):
    """
    Returns the mean squared error for model (a polynomial of the specified degree) on X and y.
    """
    # You have to write this
Now add this function to your file:

def experiment_2(m):
    """
    Runs the following experiment 100 times:

    Generate m training data points
    Generate 100 testing data points (using the same coefficients)
    For each d from 1 through 30, fit a curve of degree d to the training data and measure its mse on the testing data.

    After the 100 runs, plots the average mse of each degree.
    """
    mses = {i : [] for i in range(1, 31)}
    for i in range(100):
        coeffs = generate_coefficients()
        X_train, y_train = generate_data(m, coeffs)
        X_test, y_test = generate_data(100, coeffs)
        for d in range(1, 31):
            model = fit_curve(X_train, y_train, d)
            mses[d] += [mse(X_test, y_test, d, model)]
    averages = [mean(mses[d]) for d in mses]
    plt.ylim(0, 500)
    plt.plot(range(1, 31), averages)
    plt.xlabel('Degree')
    plt.ylabel('Average MSE (100 runs)')
    plt.show()
If you now run

experiment_2(20)
you should get a plot like this:

Plot of how MSE is affected by degree of model polynomial.

Again, try it with different parameters and see how the result changes.

Analysis
Finally, answer the following questions:

How, if at all, is overfitting/underfitting affected by the number of data points?
How, if at all, is overfitting/underfitting affected by the degree of the model polynomial?
Suppose you were asked to fit a polynomial to data that you knew were generated by another polynomial, but of unknown degree. How would you determine what degree of polynomial to use?
Hints
You'll need to do some importing at the top of your file.

Numpy's linspace function is useful for generating the data.

The Polynomial Regression section in chapter 4 of GÃ©ron has a lot of the code you're looking for.

What to Hand in
Hand in your file polynomial.py. You just need the function definitions (the ones you completed and the ones I gave you). If you put any code to run the functions at the bottom, remove it or comment it out.

Also hand in a second file with your answers to the analysis questions. This can be plain text, Word, or PDF.
